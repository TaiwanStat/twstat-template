<html><head>
  <meta charset="utf-8"><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"><link rel="icon" type="image/png" href="/favicon.ico"><meta property="og:title" content="用數據看台灣 - Team_14-外匯"><meta property="og:site_name" content="用數據看台灣 - Team_14-外匯"><meta property="og:description" content="Team_14"><title>用數據看台灣 - Team_14-外匯</title><meta http-equiv="Content-Type" content="text/html" ;="" charset="utf-8"><meta property="og:image" content="http://real.taiwanstat.com/images/assert/background.png"><meta property="og:image:type" content="image/png"><meta name="viewport" content="width=device-width, initial-scale=1.0"><!--<base href="http://real.taiwanstat.com/" target="_blank">--><link rel="stylesheet" href="http://real.taiwanstat.com/bower_components/semantic/dist/semantic.min.css" type="text/css" media="all" async=""><link rel="stylesheet" href="http://real.taiwanstat.com/css/style.css" type="text/css" media="all"><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css"><link rel="stylesheet" href="https://storage.googleapis.com/code.getmdl.io/1.0.2/material.indigo-pink.min.css" async=""><link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" async="">  <!-- my js & css -->

</head>
<body>
  <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header" id="layout-header"><header class="mdl-layout__header"><div class="mdl-layout__header-row">  <span class="mdl-layout-title"><a href="http://real.taiwanstat.com/" style="color: #FFF"><img src="http://real.taiwanstat.com/images/assert/round-logo.png" id="round-logo">用數據看台灣</a></span>  <div class="mdl-layout-spacer"></div>  <nav class="mdl-navigation mdl-layout--large-screen-only">  <a class="mdl-navigation__link" href="http://real.taiwanstat.com/">台灣開放即時資料</a>  <a class="mdl-navigation__link" href="http://long.taiwanstat.com">台灣開放統計資料</a>  <a class="mdl-navigation__link" href="http://global.taiwanstat.com/r/">世界即時資訊</a>  <a class="mdl-navigation__link" href="http://global.taiwanstat.com/l/">世界統計資訊</a>  <a class="mdl-navigation__link" href="http://taiwanstat.com/opendata">開放資料分析部落格</a>  <a class="mdl-navigation__link" href="https://www.facebook.com/taiwanstat">Facebook 粉專</a>  </nav>  <div>    </div></div></header>    <div class="mdl-layout__drawer">      <span class="mdl-layout-title"><a href="http://real.taiwanstat.com/"><img src="/images/assert/round-logo.png" id="round-logo">用數據看台灣</a></span>      <nav class="mdl-navigation">      <a class="mdl-navigation__link" href="http://real.taiwanstat.com/">台灣開放即時資料</a>      <a class="mdl-navigation__link" href="http://long.taiwanstat.com">台灣開放統計資料</a>      <a class="mdl-navigation__link" href="http://global.taiwanstat.com/r/">世界即時資訊</a>      <a class="mdl-navigation__link" href="http://global.taiwanstat.com/l/">世界統計資訊</a>      <a class="mdl-navigation__link" href="http://taiwanstat.com/opendata">開放資料分析部落格</a>      <a class="mdl-navigation__link" href="https://www.facebook.com/taiwanstat">Facebook 粉專</a>      </nav>    </div>
    <main class="mdl-layout__content" id="main-content"><h2 id="title">Team_14-外匯</h2>    <div class="fb-plugin">    <div class="fb-like-box" data-href="https://www.facebook.com/taiwanstat?fref=ts" data-colorscheme="light" data-show-faces="false"></div>    <div class="fb-like" data-href="http://real.taiwanstat.com/Team_14" data-width="300px" data-layout="standard" data-action="like" data-show-faces="true" data-share="true"></div>  </div>  <!-- my charts -->
	<div id="map" style="width:1200px;height:600px"></div>

   <div class="mdl-card mdl-shadow--2dp author"><h4><a href="http://taiwanstat_members.cannerapp.com/">About Author</a></h4>  <img class="ui circular image" src="http://real.taiwanstat.com/images/assert/background.png">      <div class="author-info"><h5>Your Name</h5></div>    </div>    </main></div><script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script><script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script><script src="http://real.taiwanstat.com/bower_components/semantic/dist/semantic.min.js"></script><script src="https://storage.googleapis.com/code.getmdl.io/1.0.2/material.min.js" async=""></script><script>  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');  ga('create', 'UA-61023469-1', 'auto');  ga('send', 'pageview');</script><div id="fb-root"></div><script async="">  (function(d, s, id) {    var js, fjs = d.getElementsByTagName(s)[0];    if (d.getElementById(id)) return;    js = d.createElement(s); js.id = id;    js.src = "//connect.facebook.net/zh_TW/sdk.js#xfbml=1&appId=600079286760117&version=v2.0";    fjs.parentNode.insertBefore(js, fjs);  }(document, 'script', 'facebook-jssdk'));</script>    <!-- my js & css -->
    <footer class="mdl-mini-footer">  <div class="mdl-mini-footer__left-section">© 2015 <a href="http://taiwanstat_members.cannerapp.com">用數據看台灣團隊</a> |     <a href="http://netdb.csie.ncku.edu.tw">NCKU-NetDB</a>      </div>  <div class="mdl-mini-footer__right-section">    <span class="footer_msg">合作提案、客製化圖表製作、意見回饋  </span>    歡迎來信: <a href="mailto:contact@taiwanstat.com">contact@taiwanstat.com</a>  </div>  </footer> <script src="/js/main.js"></script>
	<script src="http://d3js.org/topojson.v1.min.js"></script>
	<script src="./datamap.js"></script>
	<script src="https://cdn.firebase.com/js/client/2.3.1/firebase.js"></script>
	<script src="./firebase.js"></script>		
 <script>
		var ref = new Firebase("https://rate-in-time.firebaseio.com/");

		var json = [];
		var tmp = false;
		ref.on("value", function(snapshot) {
			snapshot.forEach(function(childsnapshot){
				json[childsnapshot.key()] = [];
				json[childsnapshot.key()] = childsnapshot.val();
			});
			console.log("data finish loading");
			
			//console.log(json);
			if(tmp){
				document.getElementById("map").remove();
				var iDiv = document.createElement('div');
				iDiv.id = 'map';
				iDiv.style.width = "1200px";
				iDiv.style.height = "600px";
				document.body.appendChild(iDiv);
			}

	
			var map = new Datamap({
				element: document.getElementById("map"),
				//projection: 'mercator',
				geographyConfig: {
				highlightBorderColor: '#bada55',
					popupTemplate: function(geography, data) {
						//console.log(geography);
						var country = geography.properties.name;
						if( country == "United States of America")
							return boxing(country, json["USD"], "USD");
						else if( country == "United Kingdom")
							return boxing(country, json["GBP"], "GBP");
						else if( country == "Australia")
							return boxing(country, json["AUD"], "AUD");
						else if( country == "China")
							return boxing(country, json["CNY"], "CNY");
						else if( country == "Japan")
							return boxing(country, json["JPY"], "JPY");
						else if( country == 'Canada')
							return boxing(country, json['CAD'], "CAD");
						else if( country == 'Germany' || country == 'France' || country == 'Italy' ||
									country == 'Netherlands' || country == 'Belgium' || country == 'Luxembourg' || 
									country == 'Ireland' || country == 'Greece' || country == 'Portugal' ||
									country == 'Austria' || country == 'Finland' || country == 'Slovenia' ||
									country == 'Cyprus' || country == 'Slovakia')
							return boxing(country, json["EUR"], "EUR");
						else
							return '<div class="hoverinfo">' + country;
						
					},
					highlightBorderWidth: 3
				},
				fills: {
					defaultFill: "#F0FFFF",
					USA: Choose_Color(json['USD']),
					CAN: Choose_Color(json['CAD']),
					GBR: Choose_Color(json['GBP']),
					AUS: Choose_Color(json['AUD']),
					JPN:	Choose_Color(json['JPY']),
					CHN: Choose_Color(json['CNY']),
					EU:	Choose_Color(json['EUR'])
				},
				data: {
					USA: { fillKey: "USA"},
					CAN: { fillKey: "CAN" },
					GBR: { fillKey: "GBR" },
					AUS: { fillKey: "AUS" },
					JPN: { fillKey: "JPN" },
					CHN: { fillKey: "CHN" },
					DEU: { fillKey: "EU" },	FRA: { fillKey: "EU" },	ITA: { fillKey: "EU" },	NLD: { fillKey: "EU" },
					BEL: { fillKey: "EU" },	LUX: { fillKey: "EU" },	IRL: { fillKey: "EU" },	GRC: { fillKey: "EU" },
					PRT: { fillKey: "EU" },	AUT: { fillKey: "EU" },	FIN: { fillKey: "EU" },	SVN: { fillKey: "EU" },
					CYP: { fillKey: "EU" },	SVK: { fillKey: "EU" }
					
					
					
				},
				responsive : true
			});

			map.labels();
			tmp = true;
		});
		

		
		function Choose_Color(arr){
			var colorScale_green = d3.scale.linear()
						.domain([-0.2, 0])
						.range([d3.rgb(0,255,0),d3.rgb(0,100,0)]);
			var colorScale_red = d3.scale.linear()
						.domain([0, 0.2])
						.range([d3.rgb(100,0,0),d3.rgb(255,0,0)]);
						
			max_obj = arr[arr.length-1]['rate'];
			max2_obj = arr[0]['rate'];
			
			cash_buy = max_obj.cash_rate_buying;
			cash_buy2 = max2_obj.cash_rate_buying;
			
			rate = (cash_buy-cash_buy2)/cash_buy2*100;
			console.log(rate);
			if(rate == 0)
				return "yellow";
			else if(rate < 0)
				return colorScale_green(rate);
			else if(rate > 0)
				return colorScale_red(rate);
			
			/*
			if(cash_buy > cash_buy2)
			{
				rate = cash_buy/cash_buy2;
				var color = d3.rgb(rate*200, 0, 0);
				//console.log(rate);
				//return color;
				
				return colorScale(rate);
			}
			else if(cash_buy == cash_buy2)
				return "yellow";
			else if(cash_buy < cash_buy2)
			{
				var rate = cash_buy2/cash_buy;
				var color = d3.rgb(0, rate*200, 0);
				//console.log(rate);
				//return color;
				
				return colorScale(rate);
			}
			else
				return "blue";
			*/
		}
		
		function boxing(country, arr, dollar){
			total = (arr[arr.length-1]['rate'].cash_rate_buying + arr[arr.length-1]['rate'].cash_rate_selling +
					arr[arr.length-1]['rate'].spot_rate_buying + arr[arr.length-1]['rate'].spot_rate_selling) /4;
			
			total2 = (arr[0]['rate'].cash_rate_buying + arr[0]['rate'].cash_rate_selling +
					arr[0]['rate'].spot_rate_buying + arr[0]['rate'].spot_rate_selling) / 4;
			
			change_rate = Math.round( (total-total2)/4*100000)/1000;
			//change_rate = (total-total2)/total2;
			return '<div class="hoverinfo">' + country + "<br>"
				+ '$' + dollar + '<br>'
				+ 'change rate: ' + change_rate + '%<br>'
				+ 'Cash buy: ' + arr[arr.length-1]['rate'].cash_rate_buying + '<br>'
				+ 'Cash sell: ' + arr[arr.length-1]['rate'].cash_rate_selling + '<br>'
				+ 'Spot buy: ' + arr[arr.length-1]['rate'].spot_rate_buying + '<br>'
				+ 'Spot sell: ' + arr[arr.length-1]['rate'].spot_rate_selling + '<br>';			
		}
		
		
	</script>

</body></html>